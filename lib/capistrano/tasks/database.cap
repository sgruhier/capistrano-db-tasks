namespace :db do
  namespace :remote do
    desc "Synchronize your remote database using local database data"
    task sync: "capistrano_db_tasks:check_can_push" do
      on roles(:db) do
        if fetch(:skip_data_sync_confirm) || Capistrano::DbTasks::Util.prompt("Are you sure you want to REPLACE THE REMOTE DATABASE with local database")
          Capistrano::DbTasks::Database.local_to_remote(self)
        end
      end
    end
  end

  namespace :local do
    desc "Synchronize your local database using remote database data"
    task :sync do
      on roles(:db) do
        if fetch(:skip_data_sync_confirm) || Capistrano::DbTasks::Util.prompt("Are you sure you want to erase your local database with server database")
          Capistrano::DbTasks::Database.remote_to_local(self)
        end
      end
    end
  end

  desc "Synchronize your local database using remote database data"
  task pull: "db:local:sync"

  desc "Synchronize your remote database using local database data"
  task push: "db:remote:sync"
end

namespace :load do
  task :defaults do
    set :db_local_clean, fetch(:db_local_clean, false)
  end
end
